clear; % clear CommandWindow and workspace
 sayac=0;
 AGS=zeros(3,1);
 eps=1e-8;% for sedumi
 bigeps=eps;% for sedumi
 maxiter=400;% for sedumi
 degrees=1:30;
 timescale=1;
 tolerance=1*10^(-6);%5*e-7 de iyi gozukuyordu ama r=0.05 de a=1.5 de deger bulmamalıydı%1e-6 için şekil kaydedildi veriler kayit000 ve 020 da
 %2e-6 da kaydedildi
 %1e-5 de r=0.4 ve 0.5 arası cok iyi
 %3*10-6 harika1.mat de simple rho-tolerance ile

 toleranceRed = tolerance%this is for reduced hence should be smaller
 n=2;%the dimension of the state space
 hold on
%t=0:0.01:1.57;
% xt=0.5*cos(t);
% plot(t,xt)
%  for r=0.0156:0.01:0.0156
%      a2=r;
%  for aa=0.2127:0.01   :0.2127
%          b1=-aa;
         % define the plant itself
         G = @(y)(0.1E1+y(1).^2).^5.*(0.1E1+y(2).^2).^5;
  F1=@(y)0.44527E1.*((-0.337637E-1)+0.14893E0.*y(1)+(-0.112882E1).*y(1).^2+ ...
  (-0.241064E0).*y(1).^3+(-0.158876E1).*y(1).^4+0.632196E0.*y(1).^5+ ...
  (-0.131036E1).*y(1).^6+0.458798E1.*y(1).^7+(-0.169222E1).*y(1).^8+ ...
  0.399132E1.*y(1).^9+(-0.875566E0).*y(1).^10+0.425535E0.*y(1).^11+ ...
  0.574465E0.*y(2)+0.185248E1.*y(1).*y(2)+0.55217E1.*y(1).^2.*y(2)+( ...
  -0.493319E1).*y(1).^3.*y(2)+(-0.326084E1).*y(1).^4.*y(2)+( ...
  -0.484795E1).*y(1).^5.*y(2)+(-0.440752E1).*y(1).^6.*y(2)+ ...
  0.567563E1.*y(1).^7.*y(2)+0.439061E1.*y(1).^8.*y(2)+0.198677E1.*y( ...
  1).^9.*y(2)+0.590046E0.*y(1).^10.*y(2)+(-0.175113E1).*y(1).^11.*y( ...
  2)+(-0.219495E0).*y(2).^2+(-0.133026E1).*y(1).*y(2).^2+ ...
  0.171977E2.*y(1).^2.*y(2).^2+0.329249E2.*y(1).^3.*y(2).^2+( ...
  -0.488982E1).*y(1).^4.*y(2).^2+0.334017E1.*y(1).^5.*y(2).^2+( ...
  -0.25873E2).*y(1).^6.*y(2).^2+(-0.78451E1).*y(1).^7.*y(2).^2+ ...
  0.992098E1.*y(1).^8.*y(2).^2+0.257876E2.*y(1).^9.*y(2).^2+ ...
  0.134869E2.*y(1).^10.*y(2).^2+0.271772E1.*y(1).^11.*y(2).^2+ ...
  0.317579E1.*y(2).^3+(-0.678568E1).*y(1).*y(2).^3+(-0.171504E2).*y( ...
  1).^2.*y(2).^3+0.490459E2.*y(1).^3.*y(2).^3+0.839245E2.*y(1).^4.* ...
  y(2).^3+0.241626E2.*y(1).^5.*y(2).^3+0.477477E2.*y(1).^6.*y(2).^3+ ...
  (-0.611751E2).*y(1).^7.*y(2).^3+(-0.51262E2).*y(1).^8.*y(2).^3+( ...
  -0.257682E2).*y(1).^9.*y(2).^3+0.524094E1.*y(1).^10.*y(2).^3+ ...
  0.37379E1.*y(1).^11.*y(2).^3+0.322954E0.*y(2).^4+0.15442E2.*y(1).* ...
  y(2).^4+(-0.266565E2).*y(1).^2.*y(2).^4+(-0.609506E2).*y(1).^3.*y( ...
  2).^4+0.563533E2.*y(1).^4.*y(2).^4+0.102908E3.*y(1).^5.*y(2).^4+ ...
  0.789055E2.*y(1).^6.*y(2).^4+0.158455E3.*y(1).^7.*y(2).^4+( ...
  -0.126656E2).*y(1).^8.*y(2).^4+(-0.127892E2).*y(1).^9.*y(2).^4+( ...
  -0.823835E1).*y(1).^10.*y(2).^4+0.805591E1.*y(1).^11.*y(2).^4+ ...
  0.204438E1.*y(2).^5+0.193772E1.*y(1).*y(2).^5+0.482922E2.*y(1) ...
  .^2.*y(2).^5+(-0.297312E2).*y(1).^3.*y(2).^5+(-0.102387E3).*y(1) ...
  .^4.*y(2).^5+0.293064E2.*y(1).^5.*y(2).^5+0.204438E2.*y(1).^6.*y( ...
  2).^5+0.293064E2.*y(1).^7.*y(2).^5+0.133053E3.*y(1).^8.*y(2).^5+( ...
  -0.297312E2).*y(1).^9.*y(2).^5+(-0.360259E2).*y(1).^10.*y(2).^5+ ...
  0.193772E1.*y(1).^11.*y(2).^5+(-0.322954E0).*y(2).^6+0.343339E1.* ...
  y(1).*y(2).^6+(-0.101761E2).*y(1).^2.*y(2).^6+0.877943E2.*y(1) ...
  .^3.*y(2).^6+(-0.175099E2).*y(1).^4.*y(2).^6+(-0.540518E2).*y(1) ...
  .^5.*y(2).^6+0.724464E2.*y(1).^6.*y(2).^6+0.149573E1.*y(1).^7.*y( ...
  2).^6+0.515089E2.*y(1).^8.*y(2).^6+0.135956E3.*y(1).^9.*y(2).^6+( ...
  -0.285942E2).*y(1).^10.*y(2).^6+(-0.395273E1).*y(1).^11.*y(2).^6+ ...
  0.317579E1.*y(2).^7+0.37379E1.*y(1).*y(2).^7+0.138138E2.*y(1).^2.* ...
  y(2).^7+(-0.257682E2).*y(1).^3.*y(2).^7+0.988989E2.*y(1).^4.*y(2) ...
  .^7+(-0.611751E2).*y(1).^5.*y(2).^7+0.157682E2.*y(1).^6.*y(2).^7+ ...
  0.241626E2.*y(1).^7.*y(2).^7+(-0.362876E2).*y(1).^8.*y(2).^7+ ...
  0.490459E2.*y(1).^9.*y(2).^7+0.362051E2.*y(1).^10.*y(2).^7+( ...
  -0.678568E1).*y(1).^11.*y(2).^7+0.219495E0.*y(2).^8+0.302693E1.*y( ...
  1).*y(2).^8+0.148039E2.*y(1).^2.*y(2).^8+0.11715E2.*y(1).^3.*y(2) ...
  .^8+0.132134E2.*y(1).^4.*y(2).^8+0.600468E2.*y(1).^5.*y(2).^8+( ...
  -0.214831E2).*y(1).^6.*y(2).^8+0.488616E2.*y(1).^7.*y(2).^8+( ...
  -0.159739E1).*y(1).^8.*y(2).^8+0.457769E1.*y(1).^9.*y(2).^8+ ...
  0.185147E2.*y(1).^10.*y(2).^8+0.707491E1.*y(1).^11.*y(2).^8+ ...
  0.574465E0.*y(2).^9+(-0.175113E1).*y(1).*y(2).^9+0.285674E1.*y(1) ...
  .^2.*y(2).^9+0.198677E1.*y(1).^3.*y(2).^9+0.422637E1.*y(1).^4.*y( ...
  2).^9+0.567563E1.*y(1).^5.*y(2).^9+0.158968E2.*y(1).^6.*y(2).^9+( ...
  -0.484795E1).*y(1).^7.*y(2).^9+0.118778E2.*y(1).^8.*y(2).^9+( ...
  -0.493319E1).*y(1).^9.*y(2).^9+(-0.207491E1).*y(1).^10.*y(2).^9+ ...
  0.185248E1.*y(1).^11.*y(2).^9+0.337637E-1.*y(2).^10+0.723395E0.*y( ...
  1).*y(2).^10+(-0.672983E0).*y(1).^2.*y(2).^10+0.350919E1.*y(1) ...
  .^3.*y(2).^10+(-0.118577E1).*y(1).^4.*y(2).^10+0.585237E1.*y(1) ...
  .^5.*y(2).^10+(-0.635083E0).*y(1).^6.*y(2).^10+0.980815E1.*y(1) ...
  .^7.*y(2).^10+(-0.108231E1).*y(1).^8.*y(2).^10+0.774158E1.*y(1) ...
  .^9.*y(2).^10+(-0.926242E0).*y(1).^10.*y(2).^10+0.1E1.*y(1).^11.* ...
  y(2).^10);

  F2=@(y)0.44527E1.*((-0.337637E-1)+0.574465E0.*y(1)+(-0.219495E0).*y(1) ...
  .^2+0.317579E1.*y(1).^3+0.322954E0.*y(1).^4+0.204438E1.*y(1).^5+( ...
  -0.322954E0).*y(1).^6+0.317579E1.*y(1).^7+0.219495E0.*y(1).^8+ ...
  0.574465E0.*y(1).^9+0.337637E-1.*y(1).^10+0.14893E0.*y(2)+ ...
  0.185248E1.*y(1).*y(2)+(-0.133026E1).*y(1).^2.*y(2)+(-0.678568E1) ...
  .*y(1).^3.*y(2)+0.15442E2.*y(1).^4.*y(2)+0.193772E1.*y(1).^5.*y(2) ...
  +0.343339E1.*y(1).^6.*y(2)+0.37379E1.*y(1).^7.*y(2)+0.302693E1.*y( ...
  1).^8.*y(2)+(-0.175113E1).*y(1).^9.*y(2)+0.723395E0.*y(1).^10.*y( ...
  2)+(-0.112882E1).*y(2).^2+0.55217E1.*y(1).*y(2).^2+0.171977E2.*y( ...
  1).^2.*y(2).^2+(-0.171504E2).*y(1).^3.*y(2).^2+(-0.266565E2).*y(1) ...
  .^4.*y(2).^2+0.482922E2.*y(1).^5.*y(2).^2+(-0.101761E2).*y(1).^6.* ...
  y(2).^2+0.138138E2.*y(1).^7.*y(2).^2+0.148039E2.*y(1).^8.*y(2).^2+ ...
  0.285674E1.*y(1).^9.*y(2).^2+(-0.672983E0).*y(1).^10.*y(2).^2+( ...
  -0.241064E0).*y(2).^3+(-0.493319E1).*y(1).*y(2).^3+0.329249E2.*y( ...
  1).^2.*y(2).^3+0.490459E2.*y(1).^3.*y(2).^3+(-0.609506E2).*y(1) ...
  .^4.*y(2).^3+(-0.297312E2).*y(1).^5.*y(2).^3+0.877943E2.*y(1).^6.* ...
  y(2).^3+(-0.257682E2).*y(1).^7.*y(2).^3+0.11715E2.*y(1).^8.*y(2) ...
  .^3+0.198677E1.*y(1).^9.*y(2).^3+0.350919E1.*y(1).^10.*y(2).^3+( ...
  -0.158876E1).*y(2).^4+(-0.326084E1).*y(1).*y(2).^4+(-0.488982E1).* ...
  y(1).^2.*y(2).^4+0.839245E2.*y(1).^3.*y(2).^4+0.563533E2.*y(1) ...
  .^4.*y(2).^4+(-0.102387E3).*y(1).^5.*y(2).^4+(-0.175099E2).*y(1) ...
  .^6.*y(2).^4+0.988989E2.*y(1).^7.*y(2).^4+0.132134E2.*y(1).^8.*y( ...
  2).^4+0.422637E1.*y(1).^9.*y(2).^4+(-0.118577E1).*y(1).^10.*y(2) ...
  .^4+0.632196E0.*y(2).^5+(-0.484795E1).*y(1).*y(2).^5+0.334017E1.* ...
  y(1).^2.*y(2).^5+0.241626E2.*y(1).^3.*y(2).^5+0.102908E3.*y(1) ...
  .^4.*y(2).^5+0.293064E2.*y(1).^5.*y(2).^5+(-0.540518E2).*y(1).^6.* ...
  y(2).^5+(-0.611751E2).*y(1).^7.*y(2).^5+0.600468E2.*y(1).^8.*y(2) ...
  .^5+0.567563E1.*y(1).^9.*y(2).^5+0.585237E1.*y(1).^10.*y(2).^5+( ...
  -0.131036E1).*y(2).^6+(-0.440752E1).*y(1).*y(2).^6+(-0.25873E2).* ...
  y(1).^2.*y(2).^6+0.477477E2.*y(1).^3.*y(2).^6+0.789055E2.*y(1) ...
  .^4.*y(2).^6+0.204438E2.*y(1).^5.*y(2).^6+0.724464E2.*y(1).^6.*y( ...
  2).^6+0.157682E2.*y(1).^7.*y(2).^6+(-0.214831E2).*y(1).^8.*y(2) ...
  .^6+0.158968E2.*y(1).^9.*y(2).^6+(-0.635083E0).*y(1).^10.*y(2).^6+ ...
  0.458798E1.*y(2).^7+0.567563E1.*y(1).*y(2).^7+(-0.78451E1).*y(1) ...
  .^2.*y(2).^7+(-0.611751E2).*y(1).^3.*y(2).^7+0.158455E3.*y(1).^4.* ...
  y(2).^7+0.293064E2.*y(1).^5.*y(2).^7+0.149573E1.*y(1).^6.*y(2).^7+ ...
  0.241626E2.*y(1).^7.*y(2).^7+0.488616E2.*y(1).^8.*y(2).^7+( ...
  -0.484795E1).*y(1).^9.*y(2).^7+0.980815E1.*y(1).^10.*y(2).^7+( ...
  -0.169222E1).*y(2).^8+0.439061E1.*y(1).*y(2).^8+0.992098E1.*y(1) ...
  .^2.*y(2).^8+(-0.51262E2).*y(1).^3.*y(2).^8+(-0.126656E2).*y(1) ...
  .^4.*y(2).^8+0.133053E3.*y(1).^5.*y(2).^8+0.515089E2.*y(1).^6.*y( ...
  2).^8+(-0.362876E2).*y(1).^7.*y(2).^8+(-0.159739E1).*y(1).^8.*y(2) ...
  .^8+0.118778E2.*y(1).^9.*y(2).^8+(-0.108231E1).*y(1).^10.*y(2).^8+ ...
  0.399132E1.*y(2).^9+0.198677E1.*y(1).*y(2).^9+0.257876E2.*y(1) ...
  .^2.*y(2).^9+(-0.257682E2).*y(1).^3.*y(2).^9+(-0.127892E2).*y(1) ...
  .^4.*y(2).^9+(-0.297312E2).*y(1).^5.*y(2).^9+0.135956E3.*y(1).^6.* ...
  y(2).^9+0.490459E2.*y(1).^7.*y(2).^9+0.457769E1.*y(1).^8.*y(2).^9+ ...
  (-0.493319E1).*y(1).^9.*y(2).^9+0.774158E1.*y(1).^10.*y(2).^9+( ...
  -0.875566E0).*y(2).^10+0.590046E0.*y(1).*y(2).^10+0.134869E2.*y(1) ...
  .^2.*y(2).^10+0.524094E1.*y(1).^3.*y(2).^10+(-0.823835E1).*y(1) ...
  .^4.*y(2).^10+(-0.360259E2).*y(1).^5.*y(2).^10+(-0.285942E2).*y(1) ...
  .^6.*y(2).^10+0.362051E2.*y(1).^7.*y(2).^10+0.185147E2.*y(1).^8.* ...
  y(2).^10+(-0.207491E1).*y(1).^9.*y(2).^10+(-0.926242E0).*y(1) ...
  .^10.*y(2).^10+0.425535E0.*y(2).^11+(-0.175113E1).*y(1).*y(2).^11+ ...
  0.271772E1.*y(1).^2.*y(2).^11+0.37379E1.*y(1).^3.*y(2).^11+ ...
  0.805591E1.*y(1).^4.*y(2).^11+0.193772E1.*y(1).^5.*y(2).^11+( ...
  -0.395273E1).*y(1).^6.*y(2).^11+(-0.678568E1).*y(1).^7.*y(2).^11+ ...
  0.707491E1.*y(1).^8.*y(2).^11+0.185248E1.*y(1).^9.*y(2).^11+ ...
  0.1E1.*y(1).^10.*y(2).^11+0.498674E-16.*y(1).*y(2).^12+ ...
  0.19947E-15.*y(1).^2.*y(2).^12+0.398939E-15.*y(1).^4.*y(2).^12+ ...
  0.398939E-15.*y(1).^6.*y(2).^12+(-0.19947E-15).*y(1).^8.*y(2).^12+ ...
  0.498674E-16.*y(1).^9.*y(2).^12);

F1Red=@(x)0.189478E1.*((-0.793441E-1)+0.349984E0.*x+(-0.265272E1).*x.^2+( ...
  -0.566497E0).*x.^3+(-0.373356E1).*x.^4+0.148565E1.*x.^5+( ...
  -0.307932E1).*x.^6+0.107817E2.*x.^7+(-0.397669E1).*x.^8+ ...
  0.937954E1.*x.^9+(-0.205756E1).*x.^10+0.1E1.*x.^11);
%tol=1e+4;
%u=10
%tolerance=tol/sum([sqrt(F1([0 0])^2+F2([0 0])^2),sqrt(F1([u u])^2+F2([u u])^2),sqrt(F1([u -u])^2+F2([u -u])^2),sqrt(F1([-u u])^2+F2([-u u])^2),sqrt(F1([-u -u])^2+F2([-u -u])^2)])
%toleranceRed=tol/sum([sqrt(F1Red([0])^2),sqrt(F1Red([u])^2),sqrt(F1Red([-u])^2)])
GRed=@(x)(0.1E1+x.^2).^5;
        for degree=degrees%this is actually the half of the degree
            degreeInt=1;
            x=sdpvar(n,1);
            y=sdpvar(n-1,1);
            degree*2;
            [rho,wrho] = polynomial(x,2*degree);
            [rhoRed,wrhoRed] = polynomial(y,2*degree);
            f1 = F1(x);
            f2 = F2(x);
            g = G(x);
            f1Red=F1Red(y);
            gRed=GRed(y);
            div = jacobian( f1, x(1) )+...
                jacobian( f2, x(2) );
            fun = (g*rho*div+jacobian(rho,x)*[f1;f2]*g-rho*jacobian(g,x)*[f1;f2]);
            divRed = jacobian( f1Red, y );
            funRed = (gRed*rhoRed*divRed+jacobian(rhoRed,y)*f1Red*gRed-rhoRed*jacobian(gRed,y)*f1Red);
            %(Bx * div - alpha*jacobian(Anladım KHAS112Bx, x)*([Ax*f1 + g1*c;Ax*f2 + g2*c]));
            % fun = (Bx * div - alpha*jacobian(Bx, x)*([Ax*f1 + g1*c]));
            %constr = [sos(fun),sos(rho),sos(funRed),sos(rhoRed),sum(wrho)>=tolerance,sum(wrhoRed)>=toleranceRed]%,wrho(1)>=tolerance,wrhoRed(1)>=toleranceRed];
            constr = [sos(fun),sos(rho-tolerance),sos(funRed),sos(rhoRed-toleranceRed)];
            %constr = [sos(fun),sos(rho-tolerance),sos(funRed),sos(rhoRed-toleranceRed)];
            params = [wrho; wrhoRed];
%             constr =
%             [sos(fun),sos(rho),sum(wrho)>=tolerance,wrho(1)>=tolerance];%BURADAKI
%             EKSTRA KOSULU EKLE DIGERLERINE
%             params = [wrho];
%             constr = [sos(funRed),sos(rhoRed),sum(wrhoRed)>=toleranceRed];
%            params = [ wrhoRed];
            %options = sdpsettings('solver','sdpa');
            %options = sdpsettings('solver','sdpt3');
            options = sdpsettings('solver','sedumi','verbose',0,'sedumi.eps',eps,'sedumi.bigeps', ...
                bigeps,'sedumi.maxiter',maxiter);
            %options = sdpsettings('solver','mosek');
            [sol,~,~,~]=solvesos(constr,1,options,params);
            if sol.problem==0
                %yalmip('clear')
                %sayac=sayac+1;
                %AGS(:,sayac)=[r;aa;2*degree];
                %save('kayitHarikaVDP2.mat'
                %[r aa]
                %AGS
                break
            end
            degree
            %[r aa]
            %AGS
            %yalmip('clear')
        end
  %  end
 %end
%plot(AGS(2,:),AGS(1,:),'*')
%,
display(double(wrho));
display(double(wrhoRed));








